<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Movie website with more movies. Jurabekov's  website">
    <link rel="stylesheet" href="./css/bootstrap.min.css">
    <link rel="stylesheet" href="./css/main.min.css">
    <title>KinoBUM - Watch online movies</title>
    <link rel="icon" href="./images/logo.png">
</head>
<body class="body">
    <header class="py-5">
        <nav class="navbar navbar-expand-lg">
            <div class="container-fluid">
                <a class="navbar-brand" href="./index.html">
                    <img src="./images/logo.png" width="70" height="70" alt="Kinobum's logo">
                </a>
                <h1 class="header__title mb-0 mx-auto">Visit more... Watch more...</h1>
                <div class="collapse navbar-collapse show mt-5 mt-md-4" id="navbarSupportedContent">
                    <form id="form" class="d-flex header__form ms-md-auto" role="search" autocomplete="off">
                        <input id="myInput" class="form-control input border-end-0"  type="search" placeholder="Search" aria-label="Search">
                        <button class=" movie__btn" type="click">Search</button>
                    </form>
                </div>
            </div>
        </nav>
    </header>
    <main class="site-main">
        <section class="categories pt-4">
            <div class="container mx-auto">
                <div class="alert alert-warning alert-dismissible status" role="alert">
                    <p class="mb-0">
                        Your internet connection speed is <strong>slow</strong> or <strong>disconnected.</strong> Please refresh your page.
                    </p>
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                </div>
                <a class="top position-fixed d-none" href="#top">
                    <img src="./images/arrow.png" width="100" height="50" alt="">
                </a>

                <div class="d-flex flex-column flex-xl-row justify-content-lg-between categories"> 
                    <h2 class="header__title fs-4 mb-3">All movies</h2>
                    <div class="btnParent mb-4">
                        
                    
                    <div class="dropdown">
                        <button class="btn btn-warning dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                            Sort by
                        </button>
                        <ul class="dropdown-menu bg-secondary text-center">
                            <li><a class="dropdown-item" href="#">High rating</a></li>
                            <li><a class="dropdown-item" href="#">A to Z</a></li>
                            <li><a class="dropdown-item" href="#">Low rating</a></li>
                            <li><a class="dropdown-item" href="#">Year</a></li>
                            <li><a class="dropdown-item" href="#">Z to A</a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </section>
        <section class="movie__section pt-5">
            <div class="container ">             
                <ul id="myUL" class="row list list-unstyled d-flex justify-content-center justify-content-md-between mb-0 mx-auto ">
                    
                </ul>
            </div>
        </div>
    </section>
</main>
<footer class="bg-dark py-3">
    <div class="container mx-auto">
        <div class="footer__box">
            <p class="text-center text-white mb-0">Â© 2022 developer_773. All rights reserved.
        </div>
    </div>
</footer>
<template class="movie__template">   
    <li id="item" class="col-sm-12 col-md-6 col-lg-4 col-xl-3 movie__item mb-5 me-3 position-relative shadow-lg rounded p-0" >
        <div class="card skeleton-cards placeholder-glow " aria-hidden="true">
            <img src="" class="card-img-top placeholder pt-4" alt="">
            <div class="card-body">
                <h5 class="card-title placeholder-glow">
                    <span class="placeholder col-6"></span>
                </h5>
                <p class="card-text placeholder-glow">
                    <span class="placeholder col-7"></span>
                    <span class="placeholder col-4"></span>
                    <span class="placeholder col-4"></span>
                    <span class="placeholder col-6"></span>
                    <span class="placeholder col-8"></span>
                </p>
                <a href="#" tabindex="-1" class="btn btn-secondary placeholder col-6 disabled"></a>
            </div>
        </div>
        <img class="movie__cover " src = "" alt="">  <!--cover-->
        <div class="movie__txt-box position-absolute bottom-0 w-100 p-3 ">
            <h3 class="movie__title fw-normal text-white h4 "></h3>
            <div class="movie__txt-center d-flex justify-content-between mb-3 ">
                <span class="movie__rating text-secondary d-inline-flex"></span>
                <span>
                    <time class="movie__time text-secondary d-inline-flex " datetime=""></time>
                </span>
                <span class="movie__duration text-secondary d-inline-flex"></span>
            </div>
            <p class="movie__genre text-secondary "></p>
            <div class="">
                <button class="movie__info movie__btn d-inline-flex justify-content-center" data-bs-toggle="modal" data-bs-target="#staticBackdrop">More info</button>
            </div>
        </div>
    </li>
</template>

<!-- Modal -->
<div class="modal fade" id="staticBackdrop" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
    <div class="modal-dialog ">
        <div class="modal-content ">
            <div class="card skeleton-card pt-4 pb-3 px-3 placeholder-glow position-absolute d-block" aria-hidden="true">
                <div class="w-50 placeholder-glow ">
                    <h3 class="placeholder col-7 mb-4"></h3>
                    <img src="" class="card-img-top placeholder" alt="">
                </div>
                <div class="card-body mt-4">
                    <p class="card-text placeholder-glow">
                        <span class="placeholder col-3"></span>
                        <span class="placeholder col-3"></span>
                        <span class="placeholder col-3"></span>
                        <span class="placeholder col-6 mb-5"></span>
                        <span class="placeholder col-12"></span>
                        <span class="placeholder col-12"></span>
                        <span class="placeholder col-12"></span>
                        <span class="placeholder col-12"></span>
                        <span class="placeholder col-12"></span>
                    </p>
                    <p class="placeholder col-6 mb-4"></p>
                    <button class="btn placeholder col-3 d-block ms-auto" type="btn"></button>
                </div>
            </div>
            <div class="modal-header border-bottom-0 ">
                <h3 class="modal-title fs-5 text-white" id="staticBackdropLabel ">M</h3>
                <button type="button" class="btn-close " data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body d-flex align-items-center pt-0 ">
                <div class="me-2 iframe__box ">
                    <iframe class="modal-iframe " width="390" height="218"
                    src="">
                </iframe>
            </div>
            <div class="modal-content-right p-3">  
                <h3 id="title" class="movie__title fw-normal text-white h4 "></h3>
            </div>
            <template class="modal__template">
                <div class="movie__txt-center d-flex justify-content-between mb-3">
                    <span class="movie__rating text-secondary d-inline-flex align-items-center"></span>
                    <span>
                        <time class="movie__time text-secondary d-inline-flex align-items-center" datetime=""></time>
                    </span>
                    <span class="movie__duration text-secondary d-inline-flex align-items-center"></span>
                </div>
                <p class="movie__genre text-secondary "></p>
                <p class="movie__description text-secondary "></p>
                <a class="movie__link-imdb d-inline-flex align-items-center" href="" target="_blank">Show on IMDB</a>
            </template>
        </div>
        
        <div class="modal-footer border-top-0 ">
            <button type="button" class="btn-secondary movie__btn close__btn" data-bs-dismiss="modal">Close</button>
        </div>
    </div>
</div>
</div>

<script src="./js/bootstrap.bundle.min.js"></script>
<script src="./js/movies.js"></script>
<!-- <script src="./js/fullmovies.js"></script> -->
<!-- <script src="./js/ap.js"></script> -->
<script src="./js/app.js"></script>
</body>
</html>


/* 
QIDIRILAYOTGAN FUNKSIYA 245 QATORDAN 305 QATORGACHA
*/


const elForm = document.querySelector("#form");

const elInput = document.querySelector(".input");

const selects = document.querySelector("#selects");

const elDropdown = document.querySelector(".dropdown");

const elNetStatusAlert = document.querySelector(".status");

const elCategories = document.querySelector(".categories");

const elArrowTop = document.querySelector(".top");

const elBody = document.querySelector(".body");

const elList = document.querySelector(".list");

const elItems = elList.getElementsByClassName("movie__item"); //HTML Collection object bilan o'xshaganligi uchun shu selektordan foydalanildi
// console.log(items);

const elTemplate = document.querySelector(".movie__template").content;

//slice qisak, originalga ta'sir qimasdan, yengi arrayga kopiya oladi.
//splice qisak, original array kesvoladi

const cinemas = movies.slice(0, 100);
// console.log(cinemas)

const fragment = document.createDocumentFragment();

const modalBox = document.querySelector(".modal");

const modalSkeleton = document.querySelector(".skeleton-card");

const connectionSpeed = navigator.connection.effectiveType;





// Function for removing skeleton animation
function skeleton(items, content ) {
    if (navigator.onLine) {
        setTimeout(() => {
            items.style.display = "none";
            elNetStatusAlert.classList.add("d-none");
        }, 1);
    }else if (navigator.offLine ){
        content.style.display = "none";
        elNetStatusAlert.classList.add("d-block");
        items.classList.remove("d-none");
        setInterval(() => { window.location.reload()}, 4000)
    }
}


// Rendering main items
function renderContent(param = undefined) {
    for (let i = 0; i < cinemas.length; i++) {
        
        let clonedTemplate = elTemplate.cloneNode(true);
        let cards = clonedTemplate.querySelector(".skeleton-cards");
        
        // Check internet connectivity
        skeleton(cards, elItems);
        
        clonedTemplate.querySelector(".movie__item").dataset.index = cinemas[i].imdb_rating;
        clonedTemplate.querySelector(".movie__item").dataset.year = cinemas[i].movie_year;
        clonedTemplate.querySelector(".movie__cover").src = `http://i3.ytimg.com/vi/${cinemas[i].ytid}/mqdefault.jpg`;  
        clonedTemplate.querySelector(".movie__title").textContent = cinemas[i].Title;
        clonedTemplate.querySelector(".movie__rating").textContent = cinemas[i].imdb_rating;
        clonedTemplate.querySelector(".movie__time").textContent = cinemas[i].movie_year;
        clonedTemplate.querySelector(".movie__time").dateTime = cinemas[i].movie_year + "-10-05";
        clonedTemplate.querySelector(".movie__duration").textContent = Number(Math.floor(cinemas[i].runtime / 60)) + " hr ";
        clonedTemplate.querySelector(".movie__duration").textContent += Number(cinemas[i].runtime % 60) + " min ";
        clonedTemplate.querySelector(".movie__genre").textContent = cinemas[i].Categories.split("|").join(", ");
        clonedTemplate.querySelector(".movie__info").dataset.modalIndex = cinemas[i].imdb_id;
        
        fragment.appendChild(clonedTemplate);
        
    }
    elList.appendChild(fragment);  
    
}




// console.log(genre.length);
// console.log(genres);

// console.log(genre)



// Function for checking internet connection status
function makeRequest(data) {
    setTimeout(() => {
        fetch(`{https://www.youtube.com/embed/${data}`)
        .then(response => {
            console.log('response.status: ', response.status); 
            console.log(response, "errorr");
        })
        .catch(err => {
            console.log(err, "Yes this error");
        });
    }, 3500);
}

// Function for stoping youtube video when modal box close
function stopYoutube(media) {
    
    modalBox.addEventListener('hide.bs.modal', () => { 
        media.src = ""
        setTimeout(() => {
            modalSkeleton.classList.remove("d-none");
        }, 500);
    });
}


// Event Delegation for Modal boxes
elList.addEventListener("click", function(ev) {
    let modalTitle = document.querySelector(".modal-title");
    let modalIframe = document.querySelector(".modal-iframe");
    console.log(modalIframe);
    let modalContent = document.querySelector(".modal-content-right");
    
    let clonedTemplated = document.querySelector(".modal__template").content;
    
    let clonedTemplate = clonedTemplated.cloneNode(true);
    
    // Canceling skeleton anmitation
    setTimeout(() => {
        modalSkeleton.classList.add("d-none");
    }, 1500);
    if(ev.target.matches(".movie__info") && navigator.onLine) {
        
        skeleton();
        makeRequest(modalIframe.src);
        
        let buttonId = ev.target.dataset.modalIndex;
        let find = cinemas.find(element => element.imdb_id === buttonId);
        
        modalTitle.textContent = find.Title;
        modalIframe.src = `https://www.youtube.com/embed/${find.ytid}`;
        
        stopYoutube(modalIframe);
        
        clonedTemplate.querySelector(".movie__rating").textContent = find.imdb_rating;
        clonedTemplate.querySelector(".movie__time").textContent = find.movie_year;
        clonedTemplate.querySelector(".movie__duration").textContent = Number(Math.floor(find.runtime / 60)) + " hr ";
        clonedTemplate.querySelector(".movie__duration").textContent += Number(Math.floor(find.runtime % 60)) + " min ";
        clonedTemplate.querySelector(".movie__genre").textContent = find.Categories.split("|").join(", ");
        clonedTemplate.querySelector(".movie__description").textContent = find.summary;
        clonedTemplate.querySelector(".movie__link-imdb").href = `https://www.imdb.com/title/${find.imdb_id}`
        fragment.appendChild(clonedTemplate);
        
        modalContent.innerHTML = "";
        modalContent.appendChild(fragment);
        
    }else {
        modalSkeleton.style.display = "block";
    }
    
})

renderContent(param = undefined);



const convertedEveryItemsToArray = Array.from(elItems); // HTML Collection object in one Array => every objects to every array

// Function for search movie via input
function search(value = null) {  
    
    convertedEveryItemsToArray.forEach(element => {
        let titles = element.getElementsByClassName("movie__title")[0].innerHTML.toLowerCase();
        let result = titles.match(value);
        
        if (result != null) {
            // renderContent(element);
            element.style.display = "";
            
        }else if (result === null) {
            element.style.display = "none";
            
        }
        
        
    });
}



function onsearch(evt) {
    evt.preventDefault();
    
    let elInputValue = (elInput.value.toLowerCase());   
    // // console.log(elInputValue);
    search(value = elInputValue);
    // let result = cinemas.filter(item => item.Title.includes(elInputValue));
    // console.log(cinemas);
    
    
    // if (result.length > 0) {
    //     renderContent(result);
    // }
}


// EventListener function for searching movie via input
elForm.addEventListener("submit", onsearch );


let genre = [];

const frag = document.createDocumentFragment();

const genres = movies.forEach(element => {
    
    const genresSorted = element.Categories.split("|");
    
    genresSorted.forEach(category => {
        if (!genre.includes(category)) {
            genre.push(category);
        }   
        
    });
    
    genre.sort();
    
});


genre.forEach(subItem => {
    const options = document.createElement('option');
    // console.log(subItem);
    options.textContent = subItem;
    options.classList.add("options")
    frag.appendChild(options);
})
selects.appendChild(frag);


selects.addEventListener("click", evt => {
    evt.preventDefault();
    
    const selecttt = selects.value;
    
    const finds = cinemas.filter(get => {
        return get.Categories.includes(selecttt);
    });
    
    renderContent(finds)
})


// Function for searching via buttons
function sortingContent(element, evennt) {
    
    for (let i = 0; i < elItems.length; i++) {  
        let titles = elItems[i].getElementsByClassName(element)[0].innerHTML;
        let res = titles.match(evennt.target.textContent);
        if (res) {
            elItems[i].style.display = "";
        }else {
            elItems[i].style.display = "none";
        }  
    }
    // }
    
    // for (const value of elItems) {
    //     let para = value.getElementsByClassName(element)[0].innerHTML;
    //             let res = titles.match(evennt.target.textContent);
    //     if (!res) {
    //         return value.style.display == 'none';
    //     }else {
    //         return value.style.display = "";
    //     }
    // }
}






// Function mini for searching with dropdown list
function dropdownSorting (targetedElem, targeted) {
    return targetedElem.textContent.startsWith(targeted)
}




function compareHighRating (a, b) {
    if (a.dataset.index > b.dataset.index) {
        return -1
    }
    if (a.dataset.index < b.dataset.index) {
        return 1
    }
}

function compareAz (a, b) {
    if (a.Title > b.Title) {
        return 1
    }
    if (a.Title < b.Title ) {
        return -1
    }
}


function compareLowRating (a, b) {
    if (a.dataset.index > b.dataset.index){
        return 1
    }
    if (a.dataset.index < b.dataset.index || a.dataset.index == b.dataset.index) {
        return -1
    }
}

function compareYears (a, b) {
    
    if (a.dataset.year > b.dataset.year){
        return -1
    }
    if (a.dataset.year < b.dataset.year || a.dataset.year == b.dataset.year) {
        return 1
    }
}



// Function for sorting 
function sortByRating(item, param) {
    let itemIndexes = document.querySelectorAll(item);
    let indexesArray = Array.from(itemIndexes);
    let sorted = indexesArray.sort(param);
    sorted.forEach(element => {
        elList.appendChild(element);
    });
    
}




elCategories.addEventListener("click", function(evt) {


    // let sel = selects.value;
        let targetedTags = evt.target.matches(selects);
        console.log(targetedTags);
        if(targetedTags) {
            console.log(targetedTags)
            elList.innerHTML = "";
            renderContent()
            sortingContent("movie__genre", evt);
            
        }


        
    

    let targetedDropdown = evt.target;
    
    
    if (targetedDropdown) {
        
        if (dropdownSorting(targetedDropdown, "High")) {
            elList.innerHTML = "";        
            renderContent()
            sortByRating("[data-index]", compareHighRating);
            
            
        }
        // }else if (dropdownSorting(targetedDropdown, "A")) {
        //     elList.innerHTML = "";
        //     let sorted = cinemas.sort(compareAz);
        //     renderContent(param = sorted);
        // }
        
        else if (dropdownSorting(targetedDropdown, "Low")) {
            elList.innerHTML = "";
            renderContent();
            sortByRating("[data-index]", compareLowRating)   
            
        }
        
        else if (dropdownSorting(targetedDropdown, "Year")) {
            elList.innerHTML = "";
            renderContent()
            sortByRating("[data-year]", compareYears);    
        }  
        
    }
})



// ArrowTop Button To Header
elBody.onscroll = function(e) {
    this.oldScroll = this.scrollY;
    elArrowTop.classList.remove("d-none");
    setTimeout(function() {
        elArrowTop.classList.add("d-none");
    }, 3000)
    
}

// let s =  "asdf";
// console.log(s.charAt(3));


// let ss =  "asdf";
// console.log(ss.indexOf("d"));

// let se =  "asdf";
// console.log(se.search("f"));

// let txt = "assalomalekumoka";

// console.log(txt.slice(0, txt.length-3))

// let tx = "assalomalekum";

// console.log(tx.padStart(17, "oka "));


// let m = "assalomalekum";

// console.log(m.slice(3));

// let nm = "assalomalekum";

// console.log(nm.charAt())

// let a = ["aaa", "bbb", "ccc", "aaa"];

// const as = a.reduce((acc, item) => {
//     if (item != "aaa") {
//         acc.push(item);
//     }
//     return acc
// }, [])
// // return acc

// console.log(as);

// const c = a.filter(item => {
//     if (item == "aaa") {
//         item.push(item);
//     }
//     return item;
// })

// const as = a.reduce((acc, item) => {
//     if (acc[item] >2) {
//         acc.push(item);
//     }
//     return acc
// }, [])
// // return acc

// console.log(as); 

// let b = [3, 5, 9, 12, 15]

// let x = b.reduce((acc, item) => {
//     if (item % 15 == 0) {
//         acc.push(item);
//     }
//     return acc;
// });

// console.log(x)


